<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Upstream</title>
</head>
<body>
    <h1>Upstream</h1>
    <script>
    	let dataType = {audio: true}
    	
    	navigator.mediaDevices.getUserMedia(dataType)
        .then((stream) => {
          const ws = new WebSocket('ws://' + document.location.host + '/ws');
          
          ws.onmessage = (msg) => {
      	  	console.log(msg.data)
      	  }
          
          const mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.ondataavailable = function(e) {
        	  if(ws.readyState == ws.OPEN){
	        	  ws.send(e.data);
        	  }
          }
          mediaRecorder.start(1000);
        })
        .catch((error) => {
          console.error(error);
        });
    </script>
</body>
</html>